import axios from"axios";const API_URL="http://localhost/dolibarr/htdocs/api/index.php/thirdparties",API_KEY="DSAxxkghj9N6SNub050NEi46kc1EF16L";async function checkClientExistence(clientData){const config={headers:{DOLAPIKEY:API_KEY,"Content-Type":"application/json"},params:{limit:1e3}};try{const response=await axios.get(API_URL,config),matchingClient=response.data.find((client=>client.name===clientData.nom&&client.email===clientData.email&&client.address===clientData.adresse&&client.town===clientData.ville));return matchingClient?(sessionStorage.setItem("clientId",matchingClient.id),matchingClient.id):null}catch(error){return console.error("Erreur lors de la r√©cup√©ration des clients :",error.response?error.response.data:error.message),null}}export async function saveClient(clientData){const existingClientId=await checkClientExistence(clientData);if(existingClientId)return console.log("üîÅ Le client existe d√©j√†, rowid :",existingClientId),existingClientId;{const config={headers:{DOLAPIKEY:API_KEY,"Content-Type":"application/json"}},clientPayload={name:clientData.nom,email:clientData.email,address:clientData.adresse,town:clientData.ville,client:1,fournisseur:0,entity:1,statut:0,status:1,zip:clientData.zip};console.log("üÜï Donn√©es √† ins√©rer dans l'API Dolibarr :",clientPayload);try{const newClientRowId=(await axios.post(API_URL,clientPayload,config)).data.id;return console.log("‚úÖ Client ins√©r√© avec succ√®s, rowid :",newClientRowId),sessionStorage.setItem("clientId",newClientRowId),newClientRowId}catch(error){throw new Error("‚ùå √âchec de l'ajout du client: "+error.message)}}}export async function getClientById(clientId){try{const response=await axios.get(`${API_URL}/${clientId}`,{headers:{DOLAPIKEY:API_KEY,Accept:"application/json"}});return console.log("R√©ponse de l'API:",response.data),200===response.status?Array.isArray(response.data)&&response.data.length>0?response.data[0]:response.data&&response.data.id?response.data:(console.warn("Aucune client trouv√©e pour cet ID."),null):(console.warn("R√©ponse de l'API invalide, code de statut:",response.status),null)}catch(error){return console.error("Erreur lors de la r√©cup√©ration de la facture :",error),null}}